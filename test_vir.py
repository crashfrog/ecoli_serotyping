
import src.virulencePrediction
import src.serotypePrediction
import src.genomeFunctions
import src.blastFunctions
from argparse import Namespace
import argparse
import pandas as pd
import re
import shutil
import os.path
from pathlib import Path
import definitions
import pickle

CONST_CSV = False
CONST_MINGENOMES = 1
CONST_PERIDENT = 90
CONST_PERLEN = 90
CONST_SER = True
CONST_VIR = True

def test_vir() :
    assert src.virulencePrediction.parse_virulence_factors({'qseqid': 'gnd|1_O26', 'sstart': '2103817', 'pident': '94.96', 'sframe': '1', 'qlen': '643', 'send': '2103183', 'length': '635', 'sseqid': 'LT615373.1'}, Namespace(csv=False, input='GCA_900096815.1_Ecoli_AG100_Sample2_M9_Assembly_genomic.fna', minimumGenomes=1, percentIdentity=90, percentLength=90, serotyper=True, virulenceFactors=True)) ==  {}

#testing of whether results produce correct virulence.



def test_sero_pred() :
    testing_dict = {"JHGM01000016.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|3_O26", "qlen": "643", "pident": "95.48", "send": "24199", "length": "641", "sstart": "24839", "sframe": "1", "sseqid": "JHGM01000016.1"}, "antigen": "O26"}}}, "JHJX01000037.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.33", "ant_number": "O86"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "95.79", "send": "9214", "length": "641", "sstart": "8574", "sframe": "1", "sseqid": "JHJX01000037.1"}, "antigen": "O26"}, "wzy": {"blast_record": {"qseqid": "9__wzy__wzy-O86__504", "qlen": "1341", "pident": "99.33", "send": "6396", "length": "1344", "sstart": "5053", "sframe": "1", "sseqid": "JHJX01000037.1"}, "antigen": "O86"}}}, "JHNV01000079.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H4__42", "qlen": "1050", "pident": "99.13", "send": "80528", "length": "1038", "sstart": "81565", "sframe": "1", "sseqid": "JHNV01000079.1"}, "antigen": "H4"}}}, "JHHC01000004.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H7__70", "qlen": "1758", "pident": "99.72", "send": "151501", "length": "1757", "sstart": "153257", "sframe": "1", "sseqid": "JHHC01000004.1"}, "antigen": "H7"}}}, "JHNJ01000059.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.93", "send": "1699", "length": "642", "sstart": "1058", "sframe": "1", "sseqid": "JHNJ01000059.1"}, "antigen": "O26"}}}, "AGTK01000036.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H2__20", "qlen": "1497", "pident": "99.60", "send": "86453", "length": "1489", "sstart": "87941", "sframe": "1", "sseqid": "AGTK01000036.1"}, "antigen": "H2"}}}, "AJVU01000606.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H40__46", "qlen": "1479", "pident": "94.19", "send": "16465", "length": "1480", "sstart": "17943", "sframe": "1", "sseqid": "AJVU01000606.1"}, "antigen": "H40"}}}, "AGTI01000214.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "95.48", "send": "19836", "length": "642", "sstart": "20477", "sframe": "1", "sseqid": "AGTI01000214.1"}, "antigen": "O26"}}}, "JHMM01000025.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "94.23", "send": "9695", "length": "641", "sstart": "9055", "sframe": "1", "sseqid": "JHMM01000025.1"}, "antigen": "O26"}}}, "AJVU01000301.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|62_O111", "qlen": "643", "pident": "100.00", "send": "23327", "length": "642", "sstart": "22686", "sframe": "1", "sseqid": "AJVU01000301.1"}, "antigen": "O111"}}}, "JHKX01000022.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H16__13", "qlen": "1578", "pident": "99.94", "send": "142546", "length": "1570", "sstart": "144115", "sframe": "1", "sseqid": "JHKX01000022.1"}, "antigen": "H16"}}}, "JASO01000012.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.75", "ant_number": "O145"}, "serotype": {"fliC": {"blast_record": {"qseqid": "fliC_311_AGSG01000116_H25", "qlen": "1332", "pident": "96.97", "send": "541217", "length": "1320", "sstart": "539898", "sframe": "1", "sseqid": "JASO01000012.1"}, "antigen": "H25"}, "gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "95.32", "send": "423158", "length": "641", "sstart": "422518", "sframe": "1", "sseqid": "JASO01000012.1"}, "antigen": "O26"}, "wzy": {"blast_record": {"qseqid": "9__wzy__wzy-O145__374", "qlen": "1188", "pident": "99.75", "send": "413346", "length": "1189", "sstart": "412158", "sframe": "1", "sseqid": "JASO01000012.1"}, "antigen": "O145"}}}, "JHFY01000107.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "96.26", "send": "24140", "length": "641", "sstart": "24780", "sframe": "1", "sseqid": "JHFY01000107.1"}, "antigen": "O26"}}}, "JHLP01000018.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "96.10", "send": "44845", "length": "641", "sstart": "44205", "sframe": "1", "sseqid": "JHLP01000018.1"}, "antigen": "O26"}}}, "JHMH01000073.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H2__20", "qlen": "1497", "pident": "99.60", "send": "11321", "length": "1489", "sstart": "12809", "sframe": "1", "sseqid": "JHMH01000073.1"}, "antigen": "H2"}}}, "AJVS01000516.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H11__5", "qlen": "1467", "pident": "99.93", "send": "100018", "length": "1459", "sstart": "101476", "sframe": "1", "sseqid": "AJVS01000516.1"}, "antigen": "H11"}}}, "JHHB01000003.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.92", "ant_number": "O123"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.60", "send": "23142", "length": "641", "sstart": "23782", "sframe": "1", "sseqid": "JHHB01000003.1"}, "antigen": "O26"}, "wzy": {"blast_record": {"qseqid": "9__wzy__wzy-O123-O186-Gp5__349", "qlen": "1251", "pident": "99.92", "send": "30180", "length": "1252", "sstart": "31431", "sframe": "1", "sseqid": "JHHB01000003.1"}, "antigen": "O123"}}}, "JHJY01000015.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "95.32", "send": "21997", "length": "641", "sstart": "22637", "sframe": "1", "sseqid": "JHJY01000015.1"}, "antigen": "O26"}}}, "JHNM01000013.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H7__70", "qlen": "1758", "pident": "99.72", "send": "64322", "length": "1757", "sstart": "66078", "sframe": "1", "sseqid": "JHNM01000013.1"}, "antigen": "H7"}, "gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.76", "send": "149493", "length": "641", "sstart": "150133", "sframe": "1", "sseqid": "JHNM01000013.1"}, "antigen": "O26"}}}, "AHAW01000030.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "fliC_109_AM231154_H27", "qlen": "1461", "pident": "98.09", "send": "347977", "length": "1465", "sstart": "349437", "sframe": "1", "sseqid": "AHAW01000030.1"}, "antigen": "H27"}}}, "AGSG01000154.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "96.26", "send": "34526", "length": "641", "sstart": "35166", "sframe": "1", "sseqid": "AGSG01000154.1"}, "antigen": "O26"}}}, "JFBE01000053.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H12__9", "qlen": "1788", "pident": "99.33", "send": "9402", "length": "1787", "sstart": "7616", "sframe": "1", "sseqid": "JFBE01000053.1"}, "antigen": "H12"}}}, "AGTJ01000023.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H19__18", "qlen": "1833", "pident": "98.36", "send": "74760", "length": "1832", "sstart": "76591", "sframe": "1", "sseqid": "AGTJ01000023.1"}, "antigen": "H19"}}}, "AGTJ01000128.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.93", "send": "61427", "length": "642", "sstart": "62068", "sframe": "1", "sseqid": "AGTJ01000128.1"}, "antigen": "O26"}}}, "CP001855.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H12__9", "qlen": "1788", "pident": "97.59", "send": "1970831", "length": "1787", "sstart": "1972617", "sframe": "1", "sseqid": "CP001855.1"}, "antigen": "H12"}, "gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "94.85", "send": "2128359", "length": "641", "sstart": "2128999", "sframe": "1", "sseqid": "CP001855.1"}, "antigen": "O26"}}}, "JHMM01000032.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "fliC_311_AGSG01000116_H25", "qlen": "1332", "pident": "96.89", "send": "30790", "length": "1320", "sstart": "29471", "sframe": "1", "sseqid": "JHMM01000032.1"}, "antigen": "H25"}}}, "JHKX01000028.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.46", "send": "22791", "length": "642", "sstart": "23432", "sframe": "1", "sseqid": "JHKX01000028.1"}, "antigen": "O26"}}}, "JHFY01000043.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H11__5", "qlen": "1467", "pident": "99.93", "send": "29069", "length": "1459", "sstart": "27611", "sframe": "1", "sseqid": "JHFY01000043.1"}, "antigen": "H11"}}}, "FM180568.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.23", "ant_number": "O90"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "96.10", "send": "2218784", "length": "641", "sstart": "2219424", "sframe": "1", "sseqid": "FM180568.1"}, "antigen": "O26"}, "wzy": {"blast_record": {"qseqid": "9__wzy__wzy-O90-Gp4__507", "qlen": "1158", "pident": "99.23", "send": "2221571", "length": "1167", "sstart": "2222737", "sframe": "1", "sseqid": "FM180568.1"}, "antigen": "O90"}}}, "AGTL01000031.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "95.32", "send": "21956", "length": "641", "sstart": "22596", "sframe": "1", "sseqid": "AGTL01000031.1"}, "antigen": "O26"}}}, "AGTK01000379.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.85", "ant_number": "O45"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "94.70", "send": "55280", "length": "642", "sstart": "54639", "sframe": "1", "sseqid": "AGTK01000379.1"}, "antigen": "O26"}, "wzy": {"blast_record": {"qseqid": "wzy_152_AIGX01000028_O45", "qlen": "687", "pident": "99.85", "send": "50328", "length": "688", "sstart": "49641", "sframe": "1", "sseqid": "AGTK01000379.1"}, "antigen": "O45"}}}, "JHOC01000031.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H40__46", "qlen": "1479", "pident": "94.19", "send": "8751", "length": "1480", "sstart": "7273", "sframe": "1", "sseqid": "JHOC01000031.1"}, "antigen": "H40"}}}, "AP010958.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H2__20", "qlen": "1497", "pident": "99.60", "send": "2243220", "length": "1489", "sstart": "2244708", "sframe": "1", "sseqid": "AP010958.1"}, "antigen": "H2"}, "gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "96.26", "send": "2510848", "length": "641", "sstart": "2511488", "sframe": "1", "sseqid": "AP010958.1"}, "antigen": "O26"}}}, "AHZD02000001.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.71", "ant_number": "O157"}, "serotype": {"wzx": {"blast_record": {"qseqid": "wzx_200_AKLI01000048_O157", "qlen": "1356", "pident": "99.71", "send": "597864", "length": "1357", "sstart": "596508", "sframe": "1", "sseqid": "AHZD02000001.1"}, "antigen": "O157"}, "gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "95.48", "send": "608771", "length": "641", "sstart": "608131", "sframe": "1", "sseqid": "AHZD02000001.1"}, "antigen": "O26"}, "wzy": {"blast_record": {"qseqid": "wzy_199_AKLQ01000042_O157", "qlen": "741", "pident": "99.60", "send": "595529", "length": "742", "sstart": "594788", "sframe": "1", "sseqid": "AHZD02000001.1"}, "antigen": "O157"}}}, "JHJY01000002.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H16__13", "qlen": "1578", "pident": "99.81", "send": "31633", "length": "1570", "sstart": "30064", "sframe": "1", "sseqid": "JHJY01000002.1"}, "antigen": "H16"}}}, "CP001846.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H7__70", "qlen": "1758", "pident": "100.00", "send": "2394221", "length": "1757", "sstart": "2395977", "sframe": "1", "sseqid": "CP001846.1"}, "antigen": "H7"}}}, "JHLA01000026.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H11__5", "qlen": "1467", "pident": "99.93", "send": "29170", "length": "1459", "sstart": "27712", "sframe": "1", "sseqid": "JHLA01000026.1"}, "antigen": "H11"}}}, "AE005174.2": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.93", "ant_number": "O157"}, "serotype": {"wzx": {"blast_record": {"qseqid": "wzx_200_AKLI01000048_O157", "qlen": "1356", "pident": "99.93", "send": "2853432", "length": "1357", "sstart": "2854788", "sframe": "1", "sseqid": "AE005174.2"}, "antigen": "O157"}, "gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.45", "send": "2842523", "length": "641", "sstart": "2843163", "sframe": "1", "sseqid": "AE005174.2"}, "antigen": "O26"}, "fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H7__70", "qlen": "1758", "pident": "99.94", "send": "2699592", "length": "1757", "sstart": "2701348", "sframe": "1", "sseqid": "AE005174.2"}, "antigen": "H7"}, "wzy": {"blast_record": {"qseqid": "wzy_199_AKLQ01000042_O157", "qlen": "741", "pident": "99.87", "send": "2855767", "length": "742", "sstart": "2856508", "sframe": "1", "sseqid": "AE005174.2"}, "antigen": "O157"}}}, "AHAW01000039.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.23", "ant_number": "O90"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "96.10", "send": "23047", "length": "641", "sstart": "23687", "sframe": "1", "sseqid": "AHAW01000039.1"}, "antigen": "O26"}, "wzy": {"blast_record": {"qseqid": "9__wzy__wzy-O90-Gp4__507", "qlen": "1158", "pident": "99.23", "send": "25834", "length": "1167", "sstart": "27000", "sframe": "1", "sseqid": "AHAW01000039.1"}, "antigen": "O90"}}}, "JHJE01000023.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "95.17", "send": "23634", "length": "642", "sstart": "24275", "sframe": "1", "sseqid": "JHJE01000023.1"}, "antigen": "O26"}}}, "AGTL01000001.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H28__29", "qlen": "1740", "pident": "92.29", "send": "42390", "length": "1752", "sstart": "40648", "sframe": "1", "sseqid": "AGTL01000001.1"}, "antigen": "H28"}}}, "JHNV01000080.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.30", "send": "50713", "length": "642", "sstart": "50072", "sframe": "1", "sseqid": "JHNV01000080.1"}, "antigen": "O26"}}}, "JHJJ01000027.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "94.24", "send": "4317", "length": "642", "sstart": "3676", "sframe": "1", "sseqid": "JHJJ01000027.1"}, "antigen": "O26"}}}, "JHHB01000020.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H11__5", "qlen": "1467", "pident": "99.93", "send": "21571", "length": "1459", "sstart": "23029", "sframe": "1", "sseqid": "JHHB01000020.1"}, "antigen": "H11"}}}, "AJQW01000001.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.60", "send": "259080", "length": "641", "sstart": "259720", "sframe": "1", "sseqid": "AJQW01000001.1"}, "antigen": "O26"}}}, "JHJY01000064.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.41", "ant_number": "O157"}, "serotype": {"wzx": {"blast_record": {"qseqid": "wzx_200_AKLI01000048_O157", "qlen": "1356", "pident": "99.41", "send": "13868", "length": "1357", "sstart": "12512", "sframe": "1", "sseqid": "JHJY01000064.1"}, "antigen": "O157"}, "wzy": {"blast_record": {"qseqid": "9__wzy__wzy-O157__388", "qlen": "1185", "pident": "99.41", "send": "11775", "length": "1186", "sstart": "10590", "sframe": "1", "sseqid": "JHJY01000064.1"}, "antigen": "O157"}}}, "JHMH01000098.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "96.10", "send": "23365", "length": "641", "sstart": "24005", "sframe": "1", "sseqid": "JHMH01000098.1"}, "antigen": "O26"}}}, "JASU01000004.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H2__20", "qlen": "1497", "pident": "99.53", "send": "106075", "length": "1489", "sstart": "104587", "sframe": "1", "sseqid": "JASU01000004.1"}, "antigen": "H2"}, "gnd": {"blast_record": {"qseqid": "gnd|3_O26", "qlen": "643", "pident": "95.61", "send": "4950", "length": "638", "sstart": "4313", "sframe": "1", "sseqid": "JASU01000004.1"}, "antigen": "O26"}}}, "JHHC01000011.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.93", "send": "92154", "length": "642", "sstart": "91513", "sframe": "1", "sseqid": "JHHC01000011.1"}, "antigen": "O26"}}}, "JHGM01000068.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H11__5", "qlen": "1467", "pident": "99.93", "send": "27763", "length": "1459", "sstart": "29221", "sframe": "1", "sseqid": "JHGM01000068.1"}, "antigen": "H11"}}}, "JHLA01000102.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "94.54", "send": "21307", "length": "641", "sstart": "21947", "sframe": "1", "sseqid": "JHLA01000102.1"}, "antigen": "O26"}}}, "JHOC01000023.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "95.76", "send": "20091", "length": "637", "sstart": "20727", "sframe": "1", "sseqid": "JHOC01000023.1"}, "antigen": "O26"}}}, "AJVS01000357.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.81", "ant_number": "O111"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|62_O111", "qlen": "643", "pident": "100.00", "send": "24352", "length": "642", "sstart": "24993", "sframe": "1", "sseqid": "AJVS01000357.1"}, "antigen": "O111"}, "wzy": {"blast_record": {"qseqid": "9__wzy__wzy-O111__331", "qlen": "1053", "pident": "99.81", "send": "27545", "length": "1054", "sstart": "28598", "sframe": "1", "sseqid": "AJVS01000357.1"}, "antigen": "O111"}}}, "CP000800.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "95.17", "send": "2282905", "length": "642", "sstart": "2283546", "sframe": "1", "sseqid": "CP000800.1"}, "antigen": "O26"}}}, "JFBE01000001.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "94.39", "send": "357789", "length": "642", "sstart": "357148", "sframe": "1", "sseqid": "JFBE01000001.1"}, "antigen": "O26"}}}, "AP010953.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"fliC": {"blast_record": {"qseqid": "1__fliC__fliC-H11__5", "qlen": "1467", "pident": "99.93", "send": "2715723", "length": "1459", "sstart": "2717181", "sframe": "1", "sseqid": "AP010953.1"}, "antigen": "H11"}, "gnd": {"blast_record": {"qseqid": "gnd|3_O26", "qlen": "643", "pident": "95.48", "send": "2854070", "length": "641", "sstart": "2854710", "sframe": "1", "sseqid": "AP010953.1"}, "antigen": "O26"}}}, "AUQB01000007.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": "99.88", "ant_number": "O104"}, "serotype": {"wzx": {"blast_record": {"qseqid": "wzx_106_AFOB02000091_O104", "qlen": "867", "pident": "99.88", "send": "142231", "length": "868", "sstart": "143098", "sframe": "1", "sseqid": "AUQB01000007.1"}, "antigen": "O104"}, "gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.76", "send": "140285", "length": "641", "sstart": "140924", "sframe": "1", "sseqid": "AUQB01000007.1"}, "antigen": "O26"}}}, "JASR01000005.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.46", "send": "126708", "length": "642", "sstart": "127349", "sframe": "1", "sseqid": "JASR01000005.1"}, "antigen": "O26"}}}, "BBUR01000041.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "93.30", "send": "23954", "length": "642", "sstart": "23313", "sframe": "1", "sseqid": "BBUR01000041.1"}, "antigen": "O26"}}}, "AGTH01000188.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "94.23", "send": "64859", "length": "641", "sstart": "64219", "sframe": "1", "sseqid": "AGTH01000188.1"}, "antigen": "O26"}}}, "JHNW01000003.1": {"htype": {"strength": 0, "ant_number": "-"}, "otype": {"strength": 0, "ant_number": "-"}, "serotype": {"gnd": {"blast_record": {"qseqid": "gnd|1_O26", "qlen": "643", "pident": "95.76", "send": "573492", "length": "637", "sstart": "572856", "sframe": "1", "sseqid": "JHNW01000003.1"}, "antigen": "O26"}}}}

    #print(open('/home/james/Downloads/genbank_ecoli.txt').read())
    #print("PANDAS DATA")
    dataframe = pd.read_csv('/home/james/Downloads/genbank_ecoli.txt', sep=None)
    df = dataframe[['ftp_path', 'organism_name', '# assembly_accession', 'asm_name']]

    #drop all rows without serotype
    df2 = df[df['organism_name'].str.contains(('O\d+:H\d+'))]
    #print(df2)

    m = re.compile('O\d+')

    dict_list = []

    #set all organism names to serotype H_:O_
    for index, row in df2.iterrows():
        m = re.search('O\d+:H\d+', row['organism_name'])
        df2.set_value(index, 'organism_name', m.group(0))
        m_o = re.search('(?<=O)\d+', row['organism_name'])
        m_h = re.search('(?<=H)\d+', row['organism_name'])
        dict = dict_list.append({'file': row['ftp_path'], 'H': m_h.group(0), 'O': m_o.group(0)})




    #drop duplicates in organism_name column

    df2 = df2.drop_duplicates('organism_name')

    for index, row in df2.iterrows():
        m = re.search('O\d+:H\d+', row['organism_name'])
        df2.set_value(index, 'organism_name', m.group(0))
        df2.set_value(index, 'ftp_path', row['ftp_path'] + '/' + row['# assembly_accession'] + '_' + row['asm_name'] + '_genomic.fna.gz')
        m_o = re.search('(?<=O)\d+', row['organism_name'])
        m_h = re.search('(?<=H)\d+', row['organism_name'])
        dict = dict_list.append({'file': row['ftp_path'], 'H': m_h.group(0), 'O': m_o.group(0)})


    df2['ftp_path'].to_csv('/home/james/Downloads/ftp_sero', sep='\t', index=False)


    dir = '/home/james/Downloads/ecoli_sero_tests'
    j = 0
    for filename in os.listdir(dir):
        genome_header = src.genomeFunctions.get_fasta_header_from_file(dir + '/' + filename)
        genome_name = src.genomeFunctions.get_genome_name(genome_header)
        dict_list[j]['name'] = genome_name
        j = j + 1

    file_list = src.genomeFunctions.get_files_as_list('/home/james/Downloads/ecoli_sero_tests')
    """
    db = src.blastFunctions.create_blast_db(file_list)
    query_file = definitions.SEROTYPE_FILE
    blast_output_file = src.blastFunctions.run_blast(query_file, db)

    """


    print(dict_list)
    print("DONE")



test_sero_pred()